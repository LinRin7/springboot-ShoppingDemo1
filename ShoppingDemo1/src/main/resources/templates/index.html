<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<!-- 新 Bootstrap4 核心 CSS 文件 -->
<link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
<!-- jQuery文件。务必在bootstrap.min.js 之前引入 -->
<script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
<!-- bootstrap.bundle.min.js 用于弹窗、提示、下拉菜单，包含了 popper.min.js -->
<script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script>
<!-- 最新的 Bootstrap4 核心 JavaScript 文件 -->
<script src="https://cdn.staticfile.org/twitter-bootstrap/4.3.1/js/bootstrap.min.js"></script>
<!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" ></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.1/dist/umd/popper.min.js" ></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.min.js" ></script> -->

<title>首頁</title>
</head>
<body>

<div class="container">
 <ul class="nav nav-pills justify-content-end">
    <li class="nav-item">
      <a class="p-2 text-dark" th:if="${session.user == null}">訪客，您好</a>
    </li>
    <li class="nav-item">
      <a class="p-2 text-dark" th:if="${session.user != null}" th:text="${session.user.name + '，你好'}"></a>
    </li>
    <li class="nav-item" id="login" th:if="${session.user == null}">
        <button type="button" class="btn btn-primary btn-sm" data-toggle="modal" data-target="#myModal">登入</button>
        <!-- The Modal -->
  		<div class="modal fade" id="myModal">
    		<div class="modal-dialog">
      			<div class="modal-content">
      
        		<!-- Modal Header -->
        			<div class="modal-header">
          				<h1 class="h3 mb-3 font-weight-normal">登入輸入表單</h1>
          				<button type="button" class="close" data-dismiss="modal">&times;</button>
        			</div>
        
        		<!-- Modal body -->
        			<div class="modal-body">
             			<form class="form-signin" onsubmit="return login();">                     
               			<label for="username" class="sr-only">User Name</label>
                		<input type="text" id="username" class="form-control" 
                                  placeholder="輸入使用者名稱" required autofocus><br/>
                		<label for="password" class="sr-only">Password</label>
                		<input type="password" id="password" class="form-control" 
                             placeholder="請輸入密碼" required><br/>
               			<div class="checkbox">
                   			<label>
                       			<input type="checkbox" value="remember-me"> 記住我的登入
                  			</label>
               			</div>
               			<button class="btn  btn-primary btn-block" type="submit">登入</button>  
          				</form>             
        			</div>
        
        			<!-- Modal footer -->
        			<div class="modal-footer">
         
        			</div>
        
      			</div>
    		</div>
  		</div>
    </li>
    <li class="nav-item" th:if="${session.user == null}">
      <a class="p-2 text-dark" th:href="@{/member/register}">會員註冊</a>
    </li>
    <li class="nav-item" id="logout" th:if="${session.user != null}">
       <button type="button" class="btn btn-primary btn-sm" onclick="logout()">會員登出</button>
    </li>
    <li class="nav-item">
       <a class="p-2 text-dark" th:if="${session.user != null}" th:href="@{/member/memberCenter}">會員中心</a>
    </li>
    <li class="nav-item">
      <a class="p-2 text-dark" th:onclick="showCart()" th:href="@{#}" >購物車</a>
    </li>
    
  </ul>
</div>

<div class="jumbotron text-center" style="margin-bottom:0">
  <h1>購物商城</h1>
  <p>歡迎！</p> 
</div>
<nav class="navbar navbar-expand-sm bg-dark navbar-dark">
  <a class="navbar-brand" href="#"></a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#collapsibleNavbar">
    <span class="navbar-toggler-icon"></span>
  </button>
  <div class="collapse navbar-collapse" id="collapsibleNavbar">
    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="#"></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#"></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#"></a>
      </li>    
    </ul>
  </div>  
</nav>

<div id="productList"></div>
<!-- <div class="container-fluid">
    <div class="row-fluid">
        <div class="span12">
            <table class="table table-bordered table-hover">
				
				<thead>
				
				</thead>
				
                <tbody>
                <tr th:each="item : ${page.content}">
					<td th:src="@{'/images/products/' + ${item.image}}"></td>
                    <td th:text="${item.id}">id</td>
                    <td th:text="${item.name}">name</td>
					<td th:text="${item.description}">description</td>

                    <td>
                        <button th:href="@{'/buy/'+${item.id}}" class="btn btn-outline-info">放入購物車</button>
                    </td>
                </tr>
                </tbody>
            </table>

        </div>

        <div>
            <a th:href="@{/shopping(start=0)}">[首頁]</a>
            <a th:if="${not page.isFirst()}" th:href="@{/shopping(start=${page.number-1})}">[上頁]</a>
            <a th:if="${not page.isLast()}" th:href="@{/shopping(start=${page.number+1})}">[下頁]</a>
            <a th:href="@{/shopping(start=${page.totalPages-1})}">[末頁]</a>
        </div>
    </div>
</div> -->

  	


<div class="jumbotron text-center" style="margin-bottom:0">
  <p>底部内容</p>
</div>

<script type="text/javascript">

function login(){
	//alert($("#userName").val() + ":" + $("#password").val());
	  $.ajax({
        url: "/member/login", 
        data:{"username":$("#username").val(),"password":$("#password").val()},                        
        cache:false ,
        type: "POST",
        dataType: 'text',
        success: function (msg) {              	
               alert(msg);
               $('#myModal').modal('hide');
               location.reload();
        },
        error: function (xhr, ajaxOptions, thrownError) {
            alert(xhr.status);
            alert(thrownError);
        }
    });
    
}

function logout(){
	$.get("/member/logout", function(response, status, xhr){
		alert(response);
		location.reload();
	}, "text");
}



function showCart(){
	alert("前往購物車");
	$.ajax({
		type:"GET",
		url:"/product/cart",
		dataType:"html",
		cache:"false",
		success:function(data){
			$("#productList").html(data);
		},
		error: function (xhr, ajaxOptions, thrownError) {
            alert(xhr.status); 
        }
	});
	return false;
}

function start(){

	$.ajax({
		type:"GET",
		url:"/product",
		cache:"false",
		dataType:"html",
		success:function(data){
			alert("success");
			$("#productList").html(data);
		},
		error: function (xhr, ajaxOptions, thrownError) {
            alert(xhr.status); 
        }
	});

	
	
}

$(document).ready(start);

</script>

</body>
</html>